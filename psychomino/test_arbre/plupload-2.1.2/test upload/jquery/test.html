<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

<title>Plupload - jQuery UI Widget</title>

<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/themes/base/jquery-ui.css" type="text/css" />
<link rel="stylesheet" href="../js/jquery.ui.plupload/css/jquery.ui.plupload.css" type="text/css" />

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>

<!-- production -->
<script type="text/javascript" src="../js/plupload.full.min.js"></script>
<script type="text/javascript" src="../js/jquery.ui.plupload/jquery.ui.plupload.js"></script>
<script type="text/javascript" src="../js/i18n/fr.js"></script>


</head>
<body style="font: 13px Verdana; background: #eee; color: #333">

<h1>jQuery UI Widget</h1>

<div id="container">
    <div class="error" style="color:#d21116;font-size:12px;" ></div>
  <div id="filelist">
    <div class="img"><img src="default-upload.gif" width="200" height="200" alt="" /></div>
  </div>
  <a id="pickfiles" href="javascript:;">Parcourir</a>

<input type="hidden" name="file" id="file"></div></body>
</div>

<script type="text/javascript">

  jQuery(function($) {

    var uploader = new plupload.Uploader({
      runtimes : 'gears,html5,flash,silverlight,browserplus',
      browse_button : 'pickfiles',
      container: 'container',
      url : '../upload.php',
      urlstream_upload: true
    });

    uploader.bind('FilesAdded', function(up, files) {
      $('#filelist .img').html('');
      $('#container .error').html('');
    });

    uploader.bind('FileUploaded', function(up, file, response) {
      var  obj = $.parseJSON(response.response);

      if(obj.error){
        $('#container .error').html(obj.error);
      }
      else{
        $('#file').val(obj.tmp_name);

        $('#filelist .img').html('<img src="temp/' + file.name + '"');
      }
        console.log(file);
    });

    uploader.bind('QueueChanged', function(up) {
      up.start();
    });

    uploader.bind('Init', function(up, params) {
        if(params.runtime == 'flash') {
          var version = swfobject.getFlashPlayerVersion();
          version = version.major;
          if (version < 11) {
            $('.noflash').show();
          }
        }
    });

    uploader.init();
});
</script>
</body>
</html>
